# Comprehensive Test File for Amble LSP
# This file tests all supported room reference patterns

# ============================================
# SECTION 1: Room Definitions
# ============================================

room main-hall {
    name "Main Hall"
    desc "A grand entrance hall with marble floors."
    visited true
    exit north -> library
    exit south -> kitchen
    exit east -> garden
    exit west -> armory
}

room library {
    name "Ancient Library"
    desc "Dusty books line the walls from floor to ceiling."
    exit south -> main-hall
    exit up -> tower-top
}

room kitchen {
    name "Kitchen"
    desc "A cozy kitchen with the smell of fresh bread."
    exit north -> main-hall
    exit down -> cellar
}

room garden {
    name "Secret Garden"
    desc "A hidden garden with exotic flowers."
    exit west -> main-hall
}

room armory {
    name "Armory"
    desc "Weapons and armor hang on the walls."
    exit east -> main-hall
}

room tower-top {
    name "Tower Top"
    desc "The highest point, with a view of everything."
    exit down -> library
}

room cellar {
    name "Dark Cellar"
    desc "A cold, damp cellar with barrels of wine."
    exit up -> kitchen
}

room treasure-room {
    name "Treasure Room"
    desc "Gold and jewels sparkle in the torchlight."
    exit out -> main-hall
}

# ============================================
# SECTION 2: Trigger Events - Enter/Leave
# ============================================

trigger enter-hall-trigger {
    when enter room main-hall
    do msg "Welcome to the main hall!"
}

trigger leave-library-trigger {
    when leave room library
    do msg "You leave the dusty library behind."
}

trigger enter-garden-trigger {
    when enter room garden
    do msg "The garden's beauty takes your breath away."
}

# ============================================
# SECTION 3: Conditional Checks
# ============================================

trigger check-player-location {
    when always
    if player in room kitchen
    do msg "You're in the kitchen. Something smells delicious!"
}

trigger visited-check {
    when always
    if has visited room tower-top
    do msg "You remember the view from the tower."
}

trigger multi-location-check {
    when always
    if in rooms library, kitchen, garden
    do msg "You're in one of the interesting rooms."
}

# ============================================
# SECTION 4: Actions - Push Player
# ============================================

trigger push-to-hall {
    when always
    do push player to main-hall
}

trigger push-to-cellar {
    when always
    do push player to cellar
}

trigger push-to-garden {
    when always
    do push player to garden
}

# ============================================
# SECTION 5: Lock/Unlock Actions
# ============================================

trigger lock-treasure {
    when always
    do lock exit from treasure-room direction out
}

trigger unlock-treasure {
    when always
    do unlock exit from treasure-room direction out
}

trigger lock-cellar-entrance {
    when always
    do lock exit from kitchen direction down
}

trigger unlock-cellar-entrance {
    when always
    do unlock exit from kitchen direction up
}

# ============================================
# SECTION 6: Goal Conditions
# ============================================

goal explore-all {
    desc "Explore all the rooms"
    if reached room main-hall
    if reached room library
    if reached room kitchen
    if reached room garden
    if reached room armory
    if reached room tower-top
    if reached room cellar
    if reached room treasure-room
}

# ============================================
# SECTION 7: Complex Multi-Room References
# ============================================

trigger complex-room-check {
    when enter room main-hall
    if in rooms library, garden, armory
    do push player to tower-top
}

trigger chain-visit-check {
    when leave room main-hall
    if has visited room library
    if has visited room kitchen
    if has visited room garden
    do msg "You've explored the main areas!"
}

# ============================================
# SECTION 8: Mixed Context References
# ============================================

trigger ultimate-test {
    # This trigger uses rooms in multiple contexts
    when enter room main-hall
    if player in room main-hall
    if has visited room library
    if in rooms kitchen, garden
    do push player to treasure-room
}

# ============================================
# TEST INSTRUCTIONS
# ============================================
#
# To test Go To Definition (F12):
# 1. Click on any room name anywhere in this file
# 2. Press F12
# 3. You should jump to the room definition at the top
#
# To test Find All References (Shift+F12):
# 1. Click on "main-hall" in the definition (line 8)
# 2. Press Shift+F12
# 3. You should see ~15+ references throughout the file
#
# Expected references for "main-hall":
# - Line 8: Definition
# - Lines 13-16: Exit targets
# - Lines 21, 28, 33, 38, 47: Exit targets pointing back
# - Lines 59, 98, 115, 161, 171, 176: Trigger contexts
#
# Try clicking on other room names to see their references!
